<!doctype html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=.7" />
    <title>Ø¨Ø­Ø« Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
    <link
      rel="stylesheet"
      href="/css/navb.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f4f9;
        padding: 40px;
        color: #333;
      }

      .search-box {
        max-width: 700px;
        margin: 0 auto;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      .search-box input {
        width: 90%;
        padding: 14px 50px 14px 14px; /* Ù…ÙƒØ§Ù† Ù„Ù„Ø²Ø± Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        margin: 0 auto;
        border-radius: 12px;
        border: 1px solid #ccc;
        font-size: 18px;
        outline: none;
        transition: 0.3s;
        text-align: center;
        font-weight: 700;
        letter-spacing: 0.5px;
      }

      .search-box input:focus {
        border-color: #0099ff;
        box-shadow: 0 0 10px #0099ff44;
      }

      /* Ø²Ø± Paste */
      #pasteBtn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        border: none;
        background: #0099ff;
        color: #fff;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: 0.2s;
      }

      #pasteBtn:hover {
        background: #007acc;
      }

      input:focus {
        border-color: #0099ff;
        box-shadow: 0 0 10px #0099ff44;
      }

      .results {
        margin-top: 20px;
      }

      .item {
        background: #fff;
        padding: 15px;
        border-radius: 12px;
        display: flex;
        gap: 15px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 12px;
        align-items: center;
        transition: transform 0.2s;
      }

      .item:hover {
        transform: scale(1.02);
      }

      .item img {
        width: 70px;
        height: 70px;
        border-radius: 8px;
        background: #fafafa;
        object-fit: contain;
        cursor: pointer;
      }

      .info {
        flex: 1;
      }

      .title {
        font-size: 18px;
        font-weight: bold;
      }

      .desc {
        font-size: 14px;
        color: #666;
        margin-top: 5px;
      }

      .price {
        color: #e60000;
        font-size: 16px;
        margin-top: 8px;
      }
      .anpf {
        color: #2ac92a;
        font-size: 16px;
        margin-top: 8px;
      }

      /* Overlay ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© */
      #imageOverlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      #imageOverlay img {
        max-width: 90%;
        max-height: 90%;
        border-radius: 12px;
        box-shadow: 0 0 20px #000;
      }

      #imageOverlay button {
        position: absolute;
        top: 20px;
        right: 20px;
        background: #fff;
        border: none;
        padding: 10px 15px;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Alert Ø¬Ø°Ø§Ø¨ */
      .alert {
        max-width: 700px;
        margin: 20px auto;
        padding: 12px 20px;
        border-radius: 12px;
        font-weight: bold;
        text-align: center;
      }

      .alert.success {
        background: #d4edda;
        color: #155724;
      }
      .alert.error {
        background: #f8d7da;
        color: #721c24;
      }

      /* Pagination */
      .pagination {
        text-align: center;
        margin-top: 20px;
      }

      .pagination button {
        background: #fff;
        border: 1px solid #ccc;
        padding: 8px 12px;
        margin: 0 3px;
        border-radius: 6px;
        cursor: pointer;
        transition: 0.2s;
      }

      .pagination button.active {
        background: #0099ff;
        color: #fff;
        border-color: #0099ff;
      }

      .pagination button:hover:not(.active) {
        background: #eee;
      }
    </style>
  </head>

  <body>
    <div class="search-box">
      <div style="position: relative">
        <input
          id="searchInput"
          type="text"
          placeholder="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬..." />
        <!-- Ø²Ø± Paste -->
        <button
          id="pasteBtn"
          title="Ù„ØµÙ‚ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©">
          ğŸ“‹
        </button>
      </div>

      <div id="alertContainer"></div>
      <div
        class="results"
        id="results"></div>
      <div
        class="pagination"
        id="pagination"></div>
    </div>

    <div id="imageOverlay">
      <button id="closeOverlay">Ø¥ØºÙ„Ø§Ù‚</button>
      <img
        id="overlayImg"
        src=""
        alt="ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø©" />
    </div>
    <div
      class="containeer"
      style="zoom: 1.5">
      <div class="menu-toggle">
        <span class="fa fa-plus"></span>
      </div>
      <div class="menu-round">
        <div
          class="btn-app"
          data-label="Dashboard">
          <a href="#"></a>
          <div class="fa return">
            <a href="#"
              ><i
                class="fa-solid fa-circle-left"
                style="color: white"></i>
            </a>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      const pasteBtn = document.getElementById('pasteBtn');
      const input = document.getElementById('searchInput');

      pasteBtn.addEventListener('click', async () => {
        try {
          const text = await navigator.clipboard.readText();
          input.value = text.trim(); // Ù„ØµÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
          input.dispatchEvent(new Event('input')); // ØªØ´ØºÙŠÙ„ Ø­Ø¯Ø« input Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø«
          showAlert('ØªÙ… Ù„ØµÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ù† Ø§Ù„Ø­Ø§ÙØ¸Ø©!', 'success');
        } catch (err) {
          showAlert('Ù„Ù… Ù†ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø§ÙØ¸Ø©!', 'error');
          console.error(err);
        }
      });

      // Ø§Ù„Ø¯Ø§Ù„Ø© showAlert Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
      function showAlert(message, type) {
        const alertContainer = document.getElementById('alertContainer');
        alertContainer.innerHTML = `<div class="alert ${type}">${message}</div>`;
        setTimeout(() => (alertContainer.innerHTML = ''), 3000);
      }

      const resultsDiv = document.getElementById('results');
      const paginationDiv = document.getElementById('pagination');
      const alertContainer = document.getElementById('alertContainer');
      const imageOverlay = document.getElementById('imageOverlay');
      const overlayImg = document.getElementById('overlayImg');
      const closeOverlay = document.getElementById('closeOverlay');

      let timer;
      let currentPage = 1;
      const itemsPerPage = 5;
      let currentData = [];

      // Input event
      input.addEventListener('input', () => {
        clearTimeout(timer);
        timer = setTimeout(fetchResults, 400);
      });

      // Fetch results
      function fetchResults() {
        const query = input.value.trim();
        if (query.length < 2) {
          resultsDiv.innerHTML = '';
          paginationDiv.innerHTML = '';
          alertContainer.innerHTML = '';
          return;
        }

        fetch('/api/searchee?s=' + encodeURIComponent(query))
          .then((res) => res.json())
          .then((data) => {
            if (!data.suggestions || data.suggestions.length === 0) {
              resultsDiv.innerHTML = '';
              paginationDiv.innerHTML = '';
              showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬...', 'error');
              return;
            }

            currentData = data.suggestions;
            currentPage = 1;
            showPage(currentPage);
            showAlert('ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬!', 'success');
          })
          .catch((err) => {
            resultsDiv.innerHTML = '';
            paginationDiv.innerHTML = '';
            showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...', 'error');
            console.error(err);
          });
      }

      // Ø¹Ø±Ø¶ ØµÙØ­Ø© Ù…Ø¹ÙŠÙ†Ø© Ù…Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      function showPage(page) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageData = currentData.slice(start, end);

        resultsDiv.innerHTML = pageData
          .map((item, idx) => {
            const imgSrc = item.thumb_html ? item.thumb_html.match(/src="([^"]+)"/)?.[1] : '';
            return `
            <div class="item">
                <img src="${imgSrc}" alt="${item.value}">
                <div class="info">
                    <div class="title">Libelle :${item.value}</div>
                    <div class="desc"> ${item.desc || ''}</div>
                    <div class="price">Prix : ${item.price}</div>
                    <div class="anpf">Anpf :${item.sku}</div>
                </div>
            </div>
        `;
          })
          .join('');

        // ØªÙØ¹ÙŠÙ„ ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±
        document.querySelectorAll('.item img').forEach((img, idx) => {
          img.addEventListener('click', () => {
            const globalIdx = (page - 1) * itemsPerPage + idx;
            overlayImg.src = currentData[globalIdx].full_image_url;
            imageOverlay.style.display = 'flex';
          });
        });

        // ØªØ­Ø¯ÙŠØ« Pagination
        const totalPages = Math.ceil(currentData.length / itemsPerPage);
        paginationDiv.innerHTML = '';
        for (let i = 1; i <= totalPages; i++) {
          const btn = document.createElement('button');
          btn.textContent = i;
          if (i === page) btn.classList.add('active');
          btn.addEventListener('click', () => showPage(i));
          paginationDiv.appendChild(btn);
        }
      }

      // Alert Ø¬Ø°Ø§Ø¨
      function showAlert(message, type) {
        alertContainer.innerHTML = `<div class="alert ${type}">${message}</div>`;
        setTimeout(() => (alertContainer.innerHTML = ''), 3000); // Ø§Ø®ØªÙØ§Ø¡ Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
      }

      // Ø¥ØºÙ„Ø§Ù‚ overlay
      closeOverlay.addEventListener('click', () => {
        imageOverlay.style.display = 'none';
        overlayImg.src = '';
      });

      document.querySelector('.return').addEventListener('click', (e) => {
        e.preventDefault();
        window.history.back();
      });
      $('.menu-toggle').click(function () {
        $('.menu-toggle').toggleClass('open');
        $('.menu-round').toggleClass('open');
        $('.menu-line').toggleClass('open');
      });
    </script>
  </body>
</html>
